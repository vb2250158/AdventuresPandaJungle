{"version":3,"sources":["..\\..\\..\\assets/assets\\Map.js"],"names":["startLocation","cc","Vec2","Class","extends","Component","properties","lineSize","gridSize","player","Prefab","controller","Node","obstacles","road","mapObjects","camera","EndUI","_gameEnd","getGamePosi","x","y","onLoad","node","instantiate","posi","parseInt","parent","updatePosi","line","length","push","on","event","getLocation","Math","abs","up","right","left","down","updateObject","window","GameMap","director","loadScene","manager","getCollisionManager","enabled","End","active","update","dt","judgementObstacle","position","create","nowNode","random","buildRoad","buildLine","OP","index","element","lateUpdate","sizeY","sizeX"],"mappings":"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","file":"Map.js","sourceRoot":"..\\..\\..\\assets","sourcesContent":["// const Utils={\r\n\r\n// }\r\n\r\nlet startLocation = new cc.Vec2();\r\n// let Obstacle=cc.Class({\r\n//     name:\"Obstacle\",\r\n//     properties: {\r\n\r\n//     }\r\n// });\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        lineSize: 0,\r\n        gridSize: cc.Vec2,\r\n        player: cc.Prefab,\r\n        controller: cc.Node,\r\n        obstacles: cc.Prefab,\r\n        road: cc.Prefab,\r\n        mapObjects: [],\r\n        camera: cc.Node,\r\n        EndUI: cc.Node,\r\n        _gameEnd: false\r\n    },\r\n    getGamePosi(x, y) {\r\n        return new cc.Vec2(this.gridSize.x * x, this.gridSize.y * y);\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n        //玩家\r\n        this.player = {\r\n            node: cc.instantiate(this.player),\r\n            posi: new cc.Vec2(parseInt(this.lineSize / 2), 0),\r\n        };\r\n        this.player.node.parent = this.node;\r\n\r\n        this.updatePosi(this.player.node, this.player.posi);\r\n        //摄像机\r\n        this.camera.x = this.player.node.x-300;\r\n        //构建空\r\n        let line = [];\r\n        while (line.length < this.lineSize) {\r\n            line.push(0);\r\n        }\r\n        this.mapObjects.push(line);\r\n        //操作\r\n        this.controller.on('touchstart', function (event) {\r\n            startLocation = event.getLocation();\r\n        }, this);\r\n        this.controller.on('touchend', function (event) {\r\n            let x = event.getLocation().x - startLocation.x;\r\n            let y = event.getLocation().y - startLocation.y;\r\n            if (x == 0 && y == 0 || (Math.abs(x) + Math.abs(y)) < 20) {\r\n                this.up();\r\n            }\r\n            else if (Math.abs(x) > Math.abs(y)) {\r\n                if (x > 0) {\r\n                    this.right();\r\n                } else {\r\n                    this.left();\r\n                }\r\n            } else {\r\n                if (y > 0) {\r\n                    this.up();\r\n                } else {\r\n                    this.down();\r\n                }\r\n            }\r\n        }, this);\r\n        this.updateObject();\r\n        window.GameMap = this;\r\n        this.EndUI.on('touchend', function (event) {\r\n            cc.director.loadScene(\"MainGame\");\r\n        }, this);\r\n        var manager = cc.director.getCollisionManager();\r\n        manager.enabled = true;\r\n    },\r\n    End() {\r\n        this.EndUI.active = true;\r\n        this._gameEnd = true;\r\n    },\r\n    update(dt) {\r\n\r\n    },\r\n\r\n    judgementObstacle(posi) {\r\n        return (this.mapObjects[posi.y][posi.x] == 1) ||\r\n            posi.x < 0 || posi.y < 0 || posi.x >= this.lineSize;\r\n    },\r\n    updatePosi(node, posi) {\r\n        node.position = this.getGamePosi(posi.x, posi.y);\r\n    },\r\n    create(nowNode, posi) {\r\n        let node = cc.instantiate(nowNode);\r\n        node.parent = this.node;\r\n        this.updatePosi(node, posi);\r\n    },\r\n    up() {\r\n        if (this.judgementObstacle({\r\n            x: this.player.posi.x,\r\n            y: this.player.posi.y + 1\r\n        })) {\r\n            return;\r\n        }\r\n        this.player.posi.y++;\r\n        this.updatePosi(this.player.node, this.player.posi);\r\n        this.updateObject();\r\n    },\r\n    down() {\r\n        if (this.judgementObstacle({\r\n            x: this.player.posi.x,\r\n            y: this.player.posi.y - 1\r\n        })) {\r\n            return;\r\n        }\r\n        this.player.posi.y--;\r\n        this.updatePosi(this.player.node, this.player.posi);\r\n    },\r\n    left() {\r\n        if (this.judgementObstacle({\r\n            x: this.player.posi.x - 1,\r\n            y: this.player.posi.y\r\n        })) {\r\n            return;\r\n        }\r\n        this.player.posi.x--;\r\n        this.updatePosi(this.player.node, this.player.posi);\r\n    },\r\n    right() {\r\n        if (this.judgementObstacle({\r\n            x: this.player.posi.x + 1,\r\n            y: this.player.posi.y\r\n        })) {\r\n            return;\r\n        }\r\n        this.player.posi.x++;\r\n        this.updatePosi(this.player.node, this.player.posi);\r\n    },\r\n    updateObject() {\r\n        while (this.player.posi.y + 20 > this.mapObjects.length) {\r\n            if (Math.random() > 0.5) {\r\n                //创建可以移动的死亡道路\r\n                this.buildRoad();\r\n            } else {\r\n                //创建普通带障碍物的道路\r\n                this.buildLine();\r\n            }\r\n\r\n        }\r\n    },\r\n    buildRoad() {\r\n        let line = [];\r\n        while (line.length < this.lineSize) {\r\n            line.push(0);\r\n        }\r\n        this.mapObjects.push(line);\r\n        this.create(this.road, { x: 0, y: this.mapObjects.length - 1 });\r\n    },\r\n    buildLine() {\r\n        let line = [];\r\n        //障碍物概率\r\n        let OP = 0.1;\r\n        while (line.length < this.lineSize) {\r\n            if (OP > Math.random()) {\r\n                line.push(1);\r\n            } else {\r\n                line.push(0);\r\n            }\r\n        }\r\n        this.mapObjects.push(line);\r\n        for (let index = 0; index < line.length; index++) {\r\n            const element = line[index];\r\n            switch (element) {\r\n                case 1:\r\n                    this.create(this.obstacles, { x: index, y: this.mapObjects.length - 1 });\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n    },\r\n    lateUpdate() {\r\n        let sizeY = (this.player.node.y - this.camera.y);\r\n        if (Math.abs(sizeY) > 10) {\r\n            this.camera.y += sizeY * 0.1;\r\n        }\r\n        let sizeX = (this.player.node.x - 300 - this.camera.x);\r\n        if (Math.abs(sizeX) > 200) {\r\n            this.camera.x += sizeX * 0.1;\r\n        }\r\n    }\r\n\r\n});\r\n\r\n\r\n"]}